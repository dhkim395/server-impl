<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ê²Œì‹œíŒ</title>
    <script src="token.js"></script>
</head>
<body>
<h2>ğŸ“‹ ê²Œì‹œíŒ</h2>

<!-- ê¸€ ì‘ì„± -->
<div>
    <input id="title" placeholder="ì œëª©"><br>
    <textarea id="content" placeholder="ë‚´ìš©"></textarea><br>
    <button onclick="createBoard()">ê¸€ ì‘ì„±</button>
</div>
<hr>

<!-- ê¸€ ëª©ë¡ -->
<div id="boardList"></div>

<!-- ìƒì„¸ ë³´ê¸° -->
<div id="detailBox" style="display:none">
    <h3 id="detailTitle"></h3>
    <p id="detailContent"></p>
    <p>ì‘ì„±ì: <span id="detailWriter"></span></p>
    <button onclick="editBoard()">âœ ìˆ˜ì •</button>
    <button onclick="deleteBoard()">ğŸ—‘ ì‚­ì œ</button>
    <hr>
    <div id="editForm" style="display:none">
        <input id="editTitle"><br>
        <textarea id="editContent"></textarea><br>
        <button onclick="saveEdit()">ìˆ˜ì • ì™„ë£Œ</button>
    </div>
</div>

<script>
    let selectedId = null;

    // ê¸€ ëª©ë¡
    async function loadBoards() {
        const res = await fetch("/api/boards");
        const json = await res.json();

        const listDiv = document.getElementById("boardList");
        listDiv.innerHTML = "";

        json.boards.forEach(post => {
            const div = document.createElement("div");
            div.innerHTML = `<b onclick="loadDetail(${post.id})">${post.title}</b> | ${post.writer}`;
            listDiv.appendChild(div);
        });
    }

    // ê¸€ ì‘ì„±
    async function createBoard() {
        const title = document.getElementById("title").value;
        const content = document.getElementById("content").value;

        const res = await fetch("/api/boards", {
            method: "POST",
            headers: authHeader(),
            body: JSON.stringify({ title, content })
        });

        alert(await res.text());
        loadBoards();
    }

    // ìƒì„¸ ë³´ê¸°
    async function loadDetail(id) {
        selectedId = id;
        const res = await fetch(`/api/boards/${id}`);
        const data = await res.json();

        document.getElementById("detailBox").style.display = "block";
        document.getElementById("detailTitle").innerText = data.title;
        document.getElementById("detailContent").innerText = data.content;
        document.getElementById("detailWriter").innerText = data.writer;

        document.getElementById("editForm").style.display = "none";
    }

    // ìˆ˜ì • í¼ ì—´ê¸°
    function editBoard() {
        document.getElementById("editForm").style.display = "block";
        document.getElementById("editTitle").value = document.getElementById("detailTitle").innerText;
        document.getElementById("editContent").value = document.getElementById("detailContent").innerText;
    }

    // ìˆ˜ì • ì €ì¥
    async function saveEdit() {
        const title = document.getElementById("editTitle").value;
        const content = document.getElementById("editContent").value;

        const res = await fetch(`/api/boards/${selectedId}`, {
            method: "PUT",
            headers: authHeader(),
            body: JSON.stringify({ title, content })
        });

        alert(await res.text());
        loadBoards();
    }

    // ì‚­ì œ
    async function deleteBoard() {
        const res = await fetch(`/api/boards/${selectedId}`, {
            method: "DELETE",
            headers: authHeader()
        });

        alert(await res.text());
        loadBoards();
        document.getElementById("detailBox").style.display = "none";
    }

    loadBoards();
</script>
</body>
</html>
